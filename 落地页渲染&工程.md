# 落地页实现 & 工程

## 落地页

1 涉及关键技术点

- [@formily/element-plus](https://element-plus.formilyjs.org/)
- [@formily/vue](https://vue.formilyjs.org/)
- [@formily/core](https://core.formilyjs.org/zh-CN)

2 落地页具体实现案例

- 使用 `formily/core` 中的 `createForm` 方法创建表单

  ```js
  const form = createForm({ effects: useEffects });
  ```

- 引入需要的组件

  ```js
  import { Input } from "@formily/element-plus";
  ```

- 引入 `formoly/vue` 中的 `SchemaField` 做 schema 渲染

  ```html
  <FormProvider :form="form">
    <SchemaField :schema="schema"> </SchemaField
  ></FormProvider>
  ```

  ```js
  import { FormProvider, createSchemaField } from "@formily/vue";
  const { SchemaField } = createSchemaField({
    components: {
      Input,
    },
  });
  ```

3 表格内容校验/提交

- 前端通过设计器配置好校验规则、错误提示
- 验证需要拿到 form 表单实例，通过 `@formily/vue` 的 `FormConsumer`组件来消费 form 实例，这里就需要 `@formily/core` 的 `Form`
- 给提交按钮绑定提交事件 `form.submit`

  ```html
  <FormConsumer>
    <template #default="{ form }">
      <button @click="form.submit">按钮</button>
    </template>
  </FormConsumer>
  ```

- 通过 `createForm` 的副作用钩子 `effects`,监听提交/检验事件

  ```js
  const bolen = observable.ref(true);
  const useEffects = () => {
    onFormValuesChange(() => {
      console.log(form.values, "改变了");
    });
    onFormValidateStart(() => {
      bolen.value = true;
      console.log(form.values, "开始提交");
    });
    obs.forEach((item) => {
      onFieldValidateFailed(item, () => {
        console.log(item, "检验失败");
      });
    });
    onFormValidateFailed(() => {
      console.log(form.errors);
      console.log(form.values, "失败了");
      bolen.value = false;
    });
    onFormValidateSuccess(() => {
      console.log(form.values, "成功了");
    });
    onFormSubmit(() => {
      if (bolen.value) {
        console.log(form.values, "提交了");
        // 调用数据提交请求
      }
    });
  };
  const form = createForm({ effects: useEffects });
  ```

4 schema 获取

<!-- - 接口：页面字典，查询当前有哪些页面
  - 入参（无）
  - 出参（页面标识字段，code） -->

- 获取schema
  - 请求地址
    - /page/{pageId}
  - 请求方式
    - GET
  - 返回（message, code, data）
- 提交表单数据
  - 请求地址
    - /data/save
  - 请求方式
    - POST
  - 入参（落地页唯一标识/pageId,表单数据/data）
  - 出参（message, code, data）
- 获取初始数据  
TODO  

## 工程

1 工程目录

```js
|-- SAAS-2.0
    |-- node_module
    |-- packages
    |   |-- form-app
    |   |   |-- node_module
    |   |   |-- dist
    |   |   |-- public
    |   |   |-- src
    |   |-- m-form-app
    |   |   |-- node_module
    |   |   |-- dist
    |   |   |-- public
    |   |   |-- src
    |-- .babelrc
    |-- .browserslistrc
    |-- .eslintrc.js
    |-- .gitignore
    |-- babel.config.js
    |-- lerna-debug.log
    |-- lerna.json
    |-- lint-staged.config.js
    |-- package-lock.json
    |-- package.json
    |-- projects.js
    |-- README.md
    |-- shims-vue.d.ts
    |-- tsconfig.json
    |-- vue.config.js
    |-- yarn.lock

```

2 eslint 风格

- vue/cli 默认规则

3 项目分包

- form-app/m-form-app 共用一套配置文件

4 script 命令

- 包管理
  - yarn
- 项目启动打包命令

  ```js
    // 包安装
    lerna bootstrap
    // 启动
    yarn serve:pc// form-app         
    yarn serve:mobile// m-form-app     
    // 打包
    yarn build:pc // form-app        
    yarn build:mobile// m-form-app   
  ```
