# 落地页实现 & 工程

## 落地页

1 落地页渲染

- 使用 `formily/core` 中的 `createForm` 方法创建表单

  ```js
  const form = createForm({ effects: useEffects });
  ```

- 引入需要的组件

  ```js
  import { Input } from "@formily/element-plus";
  ```

- 引入 `formoly/vue` 中的 `SchemaField` 做 schema 渲染

  ```html
  <FormProvider :form="form">
    <SchemaField :schema="schema"> </SchemaField
  ></FormProvider>
  ```

  ```js
  import { FormProvider, createSchemaField } from "@formily/vue";
  const { SchemaField } = createSchemaField({
    components: {
      Input,
    },
  });
  ```

2 表格内容校验/提交

- 在设计器生成页面的时候，配置 字段属性>校验规则
- 验证需要拿到 form 表单实例，通过 `@formily/vue` 的 `FormConsumer`组件来消费 form 实例，这里就需要 `@formily/core` 的 `Form`
- 通过给事件绑定提交事件 `form.submit`

  ```html
  <FormConsumer>
    <template #default="{ form }">
      <button @click="form.submit">按钮</button>
    </template>
  </FormConsumer>
  ```

- 通过 `createForm` 的副作用钩子 `effects`,监听提交/检验事件

  ```js
  const bolen = observable.ref(true);
  const useEffects = () => {
    onFormValuesChange(() => {
      console.log(form.values, "改变了");
    });
    onFormValidateStart(() => {
      bolen.value = true;
      console.log(form.values, "开始提交");
    });
    obs.forEach((item) => {
      onFieldValidateFailed(item, () => {
        console.log(item, "检验失败");
      });
    });
    onFormValidateFailed(() => {
      console.log(form.errors);
      console.log(form.values, "失败了");
      bolen.value = false;
    });
    onFormValidateSuccess(() => {
      console.log(form.values, "成功了");
    });
    onFormSubmit(() => {
      if (bolen.value) {
        console.log(form.values, "提交了");
        // 调用数据提交请求
      }
    });
  };
  const form = createForm({ effects: useEffects });
  ```

4 formily/Element Plus 没有导出的基础组件

- Password
- Rate
- Slider
- TreeSelect
- ...

3 schema 获取

<!-- - 接口：页面字典，查询当前有哪些页面
  - 入参（无）
  - 出参（页面标识字段，code） -->

- 接口
  - 入参（页面标识字段/code）
  - 出参（schema，表单数据提交地址）

## 工程

1 工程目录

```js
|-- SAAS-2.0
    |-- node_module
    |-- packages
    |   |-- customize-elementplus
    |   |   |-- node_module
    |   |   |-- ...
    |   |-- customize-vant
    |   |   |-- node_module
    |   |   |-- ...
    |   |-- saas
    |       |-- node_module
    |       |-- mobile-ui
    |       |   |-- dist
    |       |   |-- public
    |       |   |-- src
    |       |-- pc-ui
    |       |   |-- dist
    |       |   |-- public
    |       |   |-- src
    |       |-- .babelrc
    |       |-- .browserslistrc
    |       |-- .eslintrc.js
    |       |-- .gitignore
    |       |-- babel.config.js
    |       |-- lint-staged.config.js
    |       |-- package.json
    |       |-- projects.js
    |       |-- README.md
    |       |-- tsconfig.json
    |       |-- vue.config.js
    |-- .gitignore
    |-- lerna-debug.log
    |-- lerna.json
    |-- package-lock.json
    |-- package.json
    |-- yarn.lock

```

2 eslint 风格

- vue/cli 默认规则

3 项目分包

- pc/mobile 共用一套配置文件，路径 SAAS-2.0>packages>saas
- 自定义组件，路径 SAAS-2.0>packages

4 script 命令

- 包管理
  - yarn
- 项目启动打包命令

  ```js
  // 启动 yarn serve:mobile/pc
  "serve:mobile": "lerna exec --scope saas -- yarn serve:mobile",
  "serve:pc": "lerna exec --scope saas -- yarn serve:pc",
  // 打包 yarn build:mobile/pc
  "build:mobile": "lerna exec --scope saas -- yarn build:mobile",
  "build:pc": "lerna exec --scope saas -- yarn build:pc"
  ```

- lerna 命令

  ```js
  npm i -g lerna // 全局安装 lerna
  lerna clern // 清除所有packages中项目依赖文件
  yarn install // 安装依赖，放在最外层，如果版本不一样安装在各自目录。
  lerna changed // 用来查看发生改变的package，即预发布的包
  lerna add a --scope=b // (给b添加a) 用来给package添加依赖，可以全部添加，也可以指定添加
  lerna create <name> // 创建项目
  ```

5 全局状态管理

- pinia

6 移动端适配

- viewport




- README.md
- 落地页实现 element 版本
- 工程结构
- ~~pinis~~
